---
title: "The Relationship Between Life Expectancy and the Gini Coefficient"
author:
  - "Vishwamber Reddy"
  - "Cayou Shao"
  - "Hongyu Yin"
format: html
echo: False
---

### **Table of contents:**

Defining using adequate YAML syntax

**Executive summary:**

Maximum of 4 sentences

**Introduction:**

Maximum 10 sentences

-   The body of the report should contain the following sections:

**Methodology:**

To investigate the relationship between income inequality and life expectancy, we analyzed data from two primary sources: life expectancy data from Our World in Data and Gini coefficient data from the World Bank. The analysis focused on the period from 1990 to 2020, covering multiple countries worldwide.

The Gini coefficient, ranging from 0 to 1, measures income inequality within countries, where 0 represents perfect equality and 1 represents maximum inequality. Life expectancy at birth represents the average number of years a newborn would live under current mortality rates.

We performed the following data processing and analysis steps:

1.  Data cleaning by removing missing values and standardizing country names

2.  Merging the datasets based on country and year

3.  Computing summary statistics and correlation analysis

4.  Creating visualizations to examine relationships and trends

The cross-sectional analysis examined the relationship between life expectancy and Gini coefficient at select years. The longitudinal analysis tracked changes in both variables across time.

Table and Figure References:

As shown in Table 1, the average life expectancy was 72.82 years (SD = 7.84), and the average Gini coefficient was 0.38 (SD = 0.09), reflecting substantial variability across countries.

Figure 1 illustrates trends over time, showing a steady increase in life expectancy and a mild decline in income inequality from 1990 to 2020.

```{r load-libraries-and-data, message=FALSE, warning=FALSE}
# Load required libraries
library(tidyverse)      
library(knitr)         
library(ggplot2)       
library(dplyr)         
library(scales)        

# Fetch data directly from URLs
life_expectancy <- read.csv("https://ourworldindata.org/grapher/life-expectancy.csv?v=1&csvType=full&useColumnShortNames=false")

gini_index <- read.csv("https://ourworldindata.org/grapher/economic-inequality-gini-index.csv?v=1&csvType=full&useColumnShortNames=false")

cleaned_data <- life_expectancy %>%
  # Select relevant columns and rename for clarity
  select(Entity, Code, Year, 
         Life_Expectancy = Period.life.expectancy.at.birth...Sex..total...Age..0) %>%
  # Filter years between 1990 and 2020
  filter(Year >= 1990 & Year <= 2020) %>%
  # Join with gini data
  inner_join(
    gini_index %>%
      select(Entity, Code, Year, 
             Gini = Gini.coefficient) %>%
      filter(Year >= 1990 & Year <= 2020),
    by = c("Entity", "Code", "Year")
  ) %>%
  # Remove any remaining NA values
  na.omit()
```

```{r summary-statistics}
# Calculate correlation
correlation <- cor(cleaned_data$Life_Expectancy, cleaned_data$Gini)

summary_stats <- cleaned_data %>%
  summarise(
    Mean_Life_Expectancy = mean(Life_Expectancy),
    SD_Life_Expectancy = sd(Life_Expectancy),
    Mean_Gini = mean(Gini),
    SD_Gini = sd(Gini)
  ) %>%
  kable(
    caption = "Table 1. Summary Statistics of Life Expectancy and Gini Coefficient (1990-2020)",
    digits = 2
  )
summary_stats
```

```{r time-trend-analysis , fig.width=10, fig.height=6, message=FALSE, warning=FALSE}
# Time trend analysis
time_trend <- cleaned_data %>%
  group_by(Year) %>%
  summarize(
    mean_life_exp = mean(Life_Expectancy),
    mean_gini = mean(Gini)
  )

ggplot(time_trend, aes(x = Year)) +
  geom_line(aes(y = mean_life_exp, color = "Life Expectancy"), size = 1.2) +
  geom_line(aes(y = mean_gini * 100, color = "Gini (×100)"), size = 1.2) +  # scale Gini for visibility
  scale_y_continuous(
    name = "Life Expectancy",
    sec.axis = sec_axis(~ . / 100, name = "Gini Coefficient")
  ) +
  scale_color_manual(values = c("Life Expectancy" = "blue", "Gini (×100)" = "red")) +
  labs(
    title = "Figure 1. Trends in Life Expectancy and Income Inequality, 1990-2020",
    x = "Year",
    color = "Metric"
  ) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(color = "red"),
    axis.title.y.left = element_text(color = "blue")
  )
```

**Results:**

Our results demonstrate a negative correlation between income inequality and life expectancy (r = -0.45). Countries with higher Gini coefficients tend to have lower life expectancy.

Over the 30-year period, life expectancy increased globally from approximately 70 years in 1990 to 76 years in 2020. Meanwhile, income inequality slightly declined, with the average Gini coefficient decreasing from 0.39 to 0.35.

Figure 2 presents cross-sectional snapshots by decade. The scatter plots show a persistent negative relationship across time points, supporting the association between inequality and health outcomes.

Notably, countries with Gini coefficients below 0.3 generally achieved life expectancies above 80 years, while nations with coefficients above 0.45 frequently had life expectancies under 70 years.

The relationship remained consistent across decades, though the strength of the correlation varied by region and development level. This suggests that while income inequality is an important factor in life expectancy, other variables likely play significant roles in determining population health outcomes.

```{r scatter-plot-decades,fig.width=10, fig.height=6, message=FALSE, warning=FALSE}
# Scatter plot with decades
cleaned_data_decades <- cleaned_data %>%
  filter(Year %in% c(1990, 2000, 2010, 2020))

ggplot(cleaned_data_decades, aes(x = Gini, y = Life_Expectancy, color = as.factor(Year))) +
  geom_point(alpha = 0.7, size = 2) +
  geom_smooth(method="lm", color="blue") +
  scale_color_viridis_d() +  # Discrete color scale for decades
  labs(
    title = "Figure 2. Relationship Between Income Inequality and Life Expectancy by Decade",
    x = "Gini Coefficient",
    y = "Life Expectancy (years)",
    color = "Year"
  ) +
  theme_minimal() +
  theme(
    legend.position = "right",
    plot.title = element_text(size = 12, face = "bold")
  )
```

```{r main-visualization , fig.width=12, fig.height=8}
# Check which countries have sufficient data
countries_with_sufficient_data <- cleaned_data %>%
  group_by(Entity) %>%
  summarize(
    count = n(),
    mean_life_exp = mean(Life_Expectancy, na.rm = TRUE),
    mean_gini = mean(Gini, na.rm = TRUE)
  ) %>%
  filter(count > 5, !is.na(mean_life_exp), !is.na(mean_gini))

# Get 10 countries with high Gini and low life expectancy
high_inequality_countries <- countries_with_sufficient_data %>%
  filter(mean_life_exp < 70) %>%
  arrange(desc(mean_gini), desc(-mean_life_exp)) %>%
  head(10)

# Get 10 countries with low Gini and high life expectancy
low_inequality_countries <- countries_with_sufficient_data %>%
  filter(mean_life_exp > 70) %>%
  arrange(mean_gini, desc(mean_life_exp)) %>%
  head(10)

# Combine the two groups
selected_countries <- bind_rows(
  high_inequality_countries %>% mutate(group = "High Inequality"),
  low_inequality_countries %>% mutate(group = "Low Inequality")
)

ggplot(selected_countries) +
  geom_bar(aes(x = reorder(Entity, mean_life_exp), y = mean_life_exp, fill = group), 
          stat = "identity", alpha = 0.7) +
  geom_point(aes(x = Entity, y = mean_gini * 100), color = "red", size = 3) +
  scale_y_continuous(
    name = "Life Expectancy (years)",
    sec.axis = sec_axis(~ . / 100, name = "Gini Coefficient")
  ) +
  scale_fill_manual(values = c("High Inequality" = "coral", "Low Inequality" = "skyblue")) +
  labs(
    title = "Figure 3. Life Expectancy and Income Inequality in Selected Countries",
    subtitle = "Comparison of Countries with High and Low Inequality (1990-2020)",
    x = "Country",
    fill = "Inequality Level"
  ) +
  theme_minimal() +
  theme(
    axis.title.y.right = element_text(color = "red"),
    axis.title.y.left = element_text(color = "blue"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(size = 12, face = "bold")
  )

```

**Discussion, conclusion and recommendations**

**Reference section:**

Include at least 1 reference.\
\
